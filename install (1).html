<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Install FriendTimeKeeper</title>
  <meta name="theme-color" content="#0b101c">
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:#0b101c;color:#eaf1ff}
    .wrap{max-width:720px;margin:20px auto;padding:0 16px}
    .card{background:#111a2a;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    h1{margin:0 0 6px 0;font-size:24px}
    p{color:#9fb0d1}
    button{width:100%;padding:14px;border-radius:14px;border:none;font-weight:700;cursor:pointer;margin:8px 0}
    .primary{background:linear-gradient(180deg,#2291ff,#1c7be0);color:white}
    .secondary{background:#0f1726;color:#eaf1ff;border:1px solid rgba(255,255,255,.12)}
    .ok{color:#10b981}.warn{color:#f59e0b}.bad{color:#ef4444}
    code{background:#0f1726;padding:2px 6px;border-radius:8px}
    .log{background:#0f1726;border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:12px;font-family:ui-monospace,Consolas,Menlo,monospace;font-size:12px;white-space:pre-wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Install FriendTimeKeeper</h1>
      <p>This page helps Android Chrome show the system install prompt.</p>
      <button id="installBtn" class="primary">Try Install Now</button>
      <button id="refreshBtn" class="secondary">Refresh (activate offline support)</button>
      <div id="status" class="log" style="margin-top:10px">Status: loading…</div>
      <div style="margin-top:12px">
        <p><strong>If the button above doesn't pop the install prompt:</strong></p>
        <ol>
          <li>Open Chrome menu (⋮) → <b>Install app</b> (or <b>Add to Home screen</b>).</li>
          <li>If you don't see it, try: Chrome ⋮ → <b>Settings</b> → <b>Site settings</b> → <b>Storage</b> → Clear & reset → open this page again and refresh twice.</li>
        </ol>
        <p>Direct link to the main app: <a href="./" style="color:#7cc4ff">FriendTimeKeeper</a></p>
      </div>
    </div>
  </div>

<script>
  // Ensure the service worker is registered (same sw.js as your main app)
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }

  const statusBox = document.getElementById('status');
  const installBtn = document.getElementById('installBtn');
  const refreshBtn = document.getElementById('refreshBtn');
  let deferredPrompt = null;

  function log(msg){ statusBox.textContent = msg; }

  // Detect standalone
  const standalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
  if (standalone) {
    log('App is already installed and running in standalone mode. You can close this tab.');
  } else {
    log('Waiting for install prompt… If nothing appears, use Chrome menu (⋮) → Install app.');
  }

  // Capture the install prompt
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    log('Install prompt is READY. Tap "Try Install Now".');
  });

  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) {
      log('Install prompt not ready yet. Try Chrome menu (⋮) → Install app, or tap Refresh then try again.');
      return;
    }
    deferredPrompt.prompt();
    const choice = await deferredPrompt.userChoice;
    if (choice && choice.outcome) {
      log('User choice: ' + choice.outcome + '. If accepted, look for the icon on your Home screen.');
    }
    deferredPrompt = null;
  });

  refreshBtn.addEventListener('click', () => location.reload());
</script>
</body>
</html>
