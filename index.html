<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>FriendTimeKeeper</title>
<meta name="theme-color" content="#0b101c">
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" type="image/png" href="favicon.png">
<style>
:root{
  --bg:#0b101c; --bg2:#0a1222; --card:#0f1726; --card2:#0e1a2c;
  --text:#eaf1ff; --muted:#9fb0d1; --border:rgba(255,255,255,.12);
  --acc:#7cc4ff; --mint:#2dd4bf; --ok:#10b981; --warn:#f59e0b; --no:#ef4444;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:radial-gradient(1200px 500px at -20% -10%, rgba(124,196,255,.12), transparent 40%),
                 radial-gradient(1000px 700px at 120% 120%, rgba(45,212,191,.10), transparent 45%),
                 var(--bg);color:var(--text);
     font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif}
.container{min-height:100%;display:flex;flex-direction:column}
/* Header */
.header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(9,14,28,.9),rgba(9,14,28,.7));
  backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
.header .row{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px}
.brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.2px}
.brand img{width:30px;height:30px;border-radius:10px;border:1px solid var(--border)}
.actions{display:flex;gap:8px}
.btn{appearance:none;display:inline-flex;align-items:center;justify-content:center;gap:8px;
  padding:12px 14px;border-radius:14px;border:1px solid var(--border);background:#13233d;color:var(--text);font-weight:700;cursor:pointer}
.btn.primary{background:linear-gradient(180deg,#2291ff,#1c7be0);border:none}
.btn.ghost{background:transparent}
.btn.danger{background:linear-gradient(180deg,#ef4444,#dc2626);border:none}
/* Layout */
.page{padding:12px 14px;display:grid;gap:14px;max-width:820px;margin:0 auto;width:100%}
.card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
.h1{font-weight:800;font-size:18px;margin:0 0 6px}.sub{color:var(--muted);font-size:13px}
/* Friends list cards */
.list{display:grid;gap:10px}
.friend{display:grid;grid-template-columns:1fr auto;gap:12px;padding:14px;border:1px solid var(--border);
  border-radius:16px;background:var(--card2)}
.friend .name{font-weight:900;font-size:16px}
.friend .notes{color:var(--muted);font-size:12px}
.badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#0f1728;border:1px solid var(--border);font-size:12px}
.pill{display:inline-flex;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid var(--border);font-size:12px}
.pok{background:rgba(16,185,129,.95);color:#031a12}.pwarn{background:rgba(245,158,11,.95);color:#3b2502}.pno{background:rgba(239,68,68,.95);color:#3b0606}
.row{display:flex;gap:8px;flex-wrap:wrap}
.input,select{width:100%;padding:14px;border-radius:14px;border:1px solid var(--border);background:#0f1726;color:var(--text)}
.grid2{display:grid;gap:10px;grid-template-columns:1fr} @media(min-width:680px){.grid2{grid-template-columns:1fr 1fr}}
.footer{color:var(--muted);font-size:12px;text-align:center;padding:12px}
/* Sticky install bar */
.install{position:sticky;bottom:0;z-index:12;background:#0c1222f2;backdrop-filter:blur(10px);
  border-top:1px solid var(--border);padding:10px 14px;display:none;gap:10px;align-items:center;justify-content:space-between}
/* Searchable TZ select */
.tzwrap{position:relative}
.tzsearch{position:absolute;left:8px;right:8px;top:8px}
.tzsearch input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:#0b1322;color:var(--text);font-size:14px}
.tzselect{padding-top:52px}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="row">
      <div class="brand"><img id="appIcon" src="icon-192.png" alt=""> FriendTimeKeeper</div>
      <div class="actions">
        <button id="shareBtn" class="btn ghost">Share</button>
        <button id="aboutBtn" class="btn ghost">About</button>
      </div>
    </div>
  </div>

  <div class="page">
    <div class="card">
      <div class="h1">Your Friends</div>
      <div class="sub">Bigger buttons • Mobile‑first cards • Stored on your device</div>
      <div id="friends" class="list" style="margin-top:8px"></div>
      <div class="row" style="margin-top:8px">
        <button id="exportBtn" class="btn">Export List</button>
        <label class="btn ghost" style="cursor:pointer">
          Import List<input id="importFile" type="file" accept="application/json" style="display:none">
        </label>
      </div>
    </div>

    <div class="card">
      <div class="h1">Add Friend</div>
      <div class="grid2" style="margin-top:6px">
        <input id="name" class="input" placeholder="Name (e.g., Sam)">
        <div class="tzwrap">
          <div class="tzsearch"><input id="tzFilter" placeholder="Search timezone or city (e.g., Tokyo, London)"></div>
          <select id="tz" class="input tzselect" size="6"></select>
        </div>
        <input id="notes" class="input" placeholder="Notes: city, platform, etc.">
        <button id="addBtn" class="btn primary">Add</button>
      </div>
    </div>

    <div class="card">
      <div class="h1">Planner</div>
      <div class="sub">Pick people & find 60‑min overlaps (next 24h).</div>
      <div class="grid2" style="margin-top:8px">
        <select id="multi" class="input" multiple style="min-height:140px"></select>
        <div style="display:grid;gap:8px;grid-template-columns:1fr 1fr">
          <input id="awakeStart" class="input" type="time" value="08:00">
          <input id="awakeEnd" class="input" type="time" value="22:00">
          <button id="planBtn" class="btn">Find Overlaps</button>
        </div>
      </div>
      <div id="plan" style="margin-top:8px"></div>
    </div>

    <div class="card">
      <div class="h1">Settings</div>
      <div class="grid2">
        <div>
          <label class="sub">App icon style</label>
          <select id="iconStyle" class="input">
            <option value="classic">Classic clock hands</option>
            <option value="digital">Digital clock</option>
          </select>
        </div>
      </div>
    </div>

    <div class="footer">Created by <strong>@Shade_Kn1ght</strong> • Your timezone: <span id="myTZ"></span></div>
  </div>

  <div id="installBar" class="install">
    <div class="sub">Install FriendTimeKeeper for full‑screen & offline</div>
    <button id="installBtn" class="btn primary">Install</button>
  </div>
</div>

<script>
// Service worker + install
if('serviceWorker' in navigator){ addEventListener('load',()=>navigator.serviceWorker.register('./sw.js')); }
let dp=null; const installBar=document.getElementById('installBar');
addEventListener('beforeinstallprompt',e=>{ e.preventDefault(); dp=e; installBar.style.display='flex'; });
document.getElementById('installBtn').onclick=async()=>{ if(!dp){alert('Use Chrome menu (⋮) → Install app.');return;} dp.prompt(); await dp.userChoice; dp=null; installBar.style.display='none'; };

// Share / About
document.getElementById('shareBtn').onclick=async()=>{
  const url=location.href, text='Install FriendTimeKeeper to track friends across time zones:';
  if(navigator.share){ try{await navigator.share({title:'FriendTimeKeeper',text,url});}catch(e){} }
  else { await navigator.clipboard?.writeText(url); alert('Link copied: '+url); }
};
document.getElementById('aboutBtn').onclick=()=>alert('FriendTimeKeeper\nCreated by @Shade_Kn1ght');

// Data utilities
const LS='ftk:data:v1', LS_ICON='ftk:iconStyle';
let state=JSON.parse(localStorage.getItem(LS)||'null')||[{id:uid(),name:'Sophie',tz:'Europe/London',notes:'London, UK'},{id:uid(),name:'Lucas',tz:'America/Sao_Paulo',notes:'São Paulo, Brazil'},{id:uid(),name:'Aiko',tz:'Asia/Tokyo',notes:'Tokyo, Japan'}]; save(state);
function uid(){return Math.random().toString(36).slice(2,10);}
function save(v){localStorage.setItem(LS,JSON.stringify(v)); render(); fillMulti();}
function fmt(d,tz){return new Intl.DateTimeFormat(undefined,{hour:'2-digit',minute:'2-digit',hour12:false,timeZone:tz}).format(d);}
function hour(d,tz){return Number(new Intl.DateTimeFormat('en-GB',{hour:'2-digit',hour12:false,timeZone:tz}).format(d));}
function status(h){if(h>=8&&h<22)return['Awake','pok']; if((h>=6&&h<8)||h>=22)return['Maybe','pwarn']; return['Asleep','pno'];}
function esc(s){return (s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));}
function offsetStr(tz){ const now=new Date(); const p=new Intl.DateTimeFormat('en-US',{timeZone:tz,timeZoneName:'shortOffset'}).formatToParts(now); const t=p.find(x=>x.type==='timeZoneName'); return t ? t.value.replace('GMT','UTC') : 'UTC±0'; }

// Render list
const friendsEl=document.getElementById('friends'), myTZ=document.getElementById('myTZ');
function render(){
  myTZ.textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;
  const now=new Date(); friendsEl.innerHTML='';
  const sorted=[...state].sort((a,b)=>{const ha=hour(now,a.tz),hb=hour(now,b.tz); return ha===hb? a.name.localeCompare(b.name): ha-hb;});
  sorted.forEach(f=>{
    const [lab,cls]=status(hour(now,f.tz));
    const el=document.createElement('div');
    el.className='friend';
    el.innerHTML=`
      <div>
        <div class="name">${esc(f.name)}</div>
        <div class="notes">${esc(f.notes||'')}</div>
        <div class="row" style="margin-top:6px">
          <span class="badge">${esc(f.tz)}</span>
          <span class="badge">${offsetStr(f.tz)}</span>
          <span class="badge"><span class="mono">${fmt(now,f.tz)}</span></span>
        </div>
      </div>
      <div style="display:grid;gap:8px;align-content:start">
        <span class="pill ${cls}" style="justify-content:center">${lab}</span>
        <button class="btn" data-a="copy" data-id="${f.id}">Copy</button>
        <button class="btn danger" data-a="del" data-id="${f.id}">Remove</button>
      </div>`;
    friendsEl.appendChild(el);
  });
  friendsEl.querySelectorAll('button').forEach(b=>b.onclick=e=>{
    const id=e.currentTarget.dataset.id; const a=e.currentTarget.dataset.a;
    if(a==='del'){ state=state.filter(x=>x.id!==id); save(state); }
    if(a==='copy'){ const f=state.find(x=>x.id===id); navigator.clipboard?.writeText(fmt(new Date(),f.tz)+' ('+f.tz+')'); e.currentTarget.textContent='Copied!'; setTimeout(()=>e.currentTarget.textContent='Copy',900); }
  });
}

// Add friend
document.getElementById('addBtn').onclick=()=>{
  const nm=document.getElementById('name').value.trim(), tz=document.getElementById('tz').value, nt=document.getElementById('notes').value.trim();
  if(!nm||!tz) return; state.push({id:uid(),name:nm,tz,notes:nt}); document.getElementById('name').value=''; document.getElementById('notes').value=''; save(state);
};

// Planner
const multi=document.getElementById('multi'), awakeStart=document.getElementById('awakeStart'), awakeEnd=document.getElementById('awakeEnd'), plan=document.getElementById('plan'), planBtn=document.getElementById('planBtn');
function fillMulti(){ multi.innerHTML=''; state.forEach(f=>{ const o=document.createElement('option'); o.value=f.id; o.textContent=f.name+' — '+f.tz; multi.appendChild(o); }); }
function findOverlaps(ids,start='08:00',end='22:00'){ const chosen=state.filter(f=>ids.includes(f.id)); if(chosen.length<2)return[]; const now=new Date(); const [sH,sM]=start.split(':').map(Number), [eH,eM]=end.split(':').map(Number); const slots=[]; for(let step=0;step<=48;step++){ const st=new Date(now.getTime()+step*30*60000), en=new Date(st.getTime()+60*60000); const ok=chosen.every(fr=>{ const h1=hour(st,fr.tz), m1=Number(new Intl.DateTimeFormat('en-GB',{minute:'2-digit',timeZone:fr.tz}).format(st)), h2=hour(en,fr.tz), m2=Number(new Intl.DateTimeFormat('en-GB',{minute:'2-digit',timeZone:fr.tz}).format(en)); const sOK=(h1>sH||(h1===sH&&m1>=sM)), eOK=(h2<eH||(h2===eH&&m2<=eM)); return sOK&&eOK; }); if(ok) slots.push(st);} return slots.slice(0,10); }
planBtn.onclick=()=>{ const ids=Array.from(multi.selectedOptions).map(o=>o.value); const s=awakeStart.value, e=awakeEnd.value; const slots=findOverlaps(ids,s,e); if(!slots.length){ plan.innerHTML='<div class="sub">No overlaps in the next 24h.</div>'; return; } plan.innerHTML=slots.map(dt=>{ const lines=ids.map(id=>{ const f=state.find(x=>x.id===id); return `<span class="badge">${f.name}: <span class="mono">${fmt(dt,f.tz)}</span> (${f.tz})</span>`; }).join(' '); return `<div class="card" style="padding:10px">${lines}<div class="sub" style="margin-top:6px">Base slot: <span class="mono">${new Date(dt).toLocaleString()}</span></div></div>`; }).join(''); };

// Icon style
const iconStyleSel=document.getElementById('iconStyle'), appIcon=document.getElementById('appIcon');
function applyIcon(){ const v=localStorage.getItem(LS_ICON)||'classic'; iconStyleSel.value=v; appIcon.src = v==='digital' ? 'icon-digital-192.png' : 'icon-192.png'; }
iconStyleSel.onchange=()=>{ localStorage.setItem(LS_ICON, iconStyleSel.value); applyIcon(); };

// Export / Import
document.getElementById('exportBtn').onclick=()=>{
  const blob=new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='friendtimekeeper-export.json'; a.click(); URL.revokeObjectURL(url);
};
document.getElementById('importFile').onchange=(e)=>{
  const file=e.target.files[0]; if(!file) return;
  const rd=new FileReader(); rd.onload=()=>{ try{ const data=JSON.parse(rd.result); if(Array.isArray(data)){ state=data; save(state); alert('Imported ✔'); } else alert('Invalid file'); }catch{ alert('Invalid JSON file'); } };
  rd.readAsText(file);
};

// Timezone select with filter
const tzSel=document.getElementById('tz'), tzFilter=document.getElementById('tzFilter');
function populateTZ(){ const z=(Intl.supportedValuesOf?Intl.supportedValuesOf('timeZone'):['UTC','Europe/London','Asia/Tokyo','America/New_York','Australia/Brisbane']); tzSel.innerHTML=''; z.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; tzSel.appendChild(o); }); tzSel.value=Intl.DateTimeFormat().resolvedOptions().timeZone||'UTC'; tzFilter.oninput=()=>{ const q=tzFilter.value.toLowerCase(); Array.from(tzSel.options).forEach(o=>{ o.hidden = !o.value.toLowerCase().includes(q); }); }; }
function init(){ populateTZ(); applyIcon(); render(); fillMulti(); setInterval(render,30000); const standalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone; if(standalone) installBar.style.display='none'; }
init();
</script>
</body>
</html>
